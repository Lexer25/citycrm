citycrm
14.04.2024
в файле C:\xampp\htdocs\citycrm\application\config\config_newcrm.php добавлены параметры работы CityCRM
'view_settings'=>true,// показывать ли пункт Настройка в хидере? В рабочем режиме необходимо выключить показ, т.к. формы конфигураций еще не готовы для пользователей.
'iphost'=>'127.0.0.1',// тут надо указать IP адрес сервера СКУД - этот параметр встроен в template, и необходим для разрешения работы с других компьтеров.

Форматы данных
0 - HEX 8 байт
1 - 001A
2 - DEC 10 знаков
Добавлены параметры конфигурации system

setting.baseFormatRfid - формат хранения номера RFID в базе  данных. 0 - DEC, 1-001A
setting.formatViewAll - 0 - будет показан только один вариант RFID, 1 - будут показаны все возможные варианты RFID (длинное DEC и comma DEC)
setting.regFormatRfid - формат данных от регистрационного считыателя. Возможность работы с разными форматами заложена, но не реализован. Формат всегда считываем DEC
setting.screenFormatRFID - формат вывода номера RFID на экран (1 или 2)
setting.viewFromatForEdit - формат вывода номера RFID при его редактировании. В принципе он должен совпадать с параметром setting.screenFormatRFID, но я пока не уверен.

orgname - название организации, выводится в шапке браузера.

31.03.2024
Добавлен модуль stat, модель stat.php. Модель содержит разного рода преобразования номеров RFID. В bootstrap добавлено разрешение работать с этим модулем.

На страницы с выводом номера RFID добавлен вывод этого номера в виде длинного целого (10 символов) и десятичного через запятую.
Изменен механизм поиска карты. Теперь при вводе номера в виде длинного целого происходит его пребразование к виду 001A и выполняется поиск. Теперь поиск работает правильно.
Изменен механизм регистрации карты. Теперь номер карты надо вводит в виде длинного целого (от 3 до 9 цифр). После нажатия кнопки "Сохранить" происходит преобразование номера карты к формату 001A и карта сохраняется в базе данных.
В настройки C:\xampp\htdocs\citycrm\application\config\config_newcrm.php добавлены строки
'view_settings'=>false,// показывать ли пункт Настройка в хидере?
'iphost'=>'127.0.0.1',// тут надо указать IP адрес сервера СКУД
При установке на объекте параметру 'iphost' надо указать текущий IP адрес компьютера. От автоматического выбора IP адреса я отказался, т.к. у компьютера может быть несколько IP, и критерий выбора не ясен.

Для сотрудника Администратор запрещены разного рода редактирования и изменения.

ToDo
во всех местах заменить конструкции вида Arr::get($card, 'ID_CARD') на работу с классом $key->id_card. В класс вынести варианты отображения номера RFID на экране. Разные виды отображения имеет только RFID.
Доработать механизм настроек, ввести возмжоность менять название объекта.
Добавить контроль времени открытого состояний рабочего окна.
<?php echo Debug::vars('43', 'No active '.(time() - Session::instance()->get('last_active')));?>
Если оно превышает заданные в конфигурации время, то переходить на logout: не должно окно быть открым неограниченное время. А это время храниться в настройках.

28.03.2024
Исправлены ошибки с сохранением note для сотрудников. Все находится в файле C:\xampp\htdocs\citycrm\application\classes\Contact.php
Настройки вынесены в отдлельный modules tuner. Путь к базе данных прописан в файле C:\xampp\htdocs\citycrm\modules\tuner\config\database.php,
имеет значение 
	'dsn'        => 'sqlite:'.MODPATH .'\\tuner\\Config\\config.sqlite',
База данных C:\xampp\htdocs\citycrm\modules\tuner\config\config.sqlite
Название объекта хранится в базе данных. Для редактирования названия необходимо войти в раздел Настройка 
В разделе modules сделан шаблон для модулей template
18.01.2024
по результатам эксплуатации во ВНИИЖТ внесены следующие изменения:
1. добавлена сортировка таблиц. Для этого добавлены C:\xampp\htdocs\citycrm\js\sort\jquery.tablesorter.js.
В таблице указан класс tablesorter-blue, и его прорисовка указана в C:\xampp\htdocs\citycrm\css\theme.blue.css.
2. Исправлены:
- не сохранял note. Исправлено.
- не сохранял номер документа. Исправлено.
- при регистрации гостя дата докумета теперь указаывается текущая дата.
- после регистрации гостя открывается окно регистрации нового гостя, чтобы не тратить время на переходы

27.12.2023
Работа с гостем реализована через класс Guest.
Это потребовало сделать класс работы с картами Keyk.
Вывод сообщений alert доработан, теперь есть метод arralert, и его вывод на экран реализован в Alert.php. Тут же указаны возможные варианты alert указаны в файле 
AlertState.php
тут же указаны связанные с ним иконки.


5.12.2023
{*}
внесены изменения в контроллеры 
C:\xampp\htdocs\citycrm\application\classes\Controller\companies.php
C:\xampp\htdocs\citycrm\application\classes\Controller\contacts.php
C:\xampp\htdocs\citycrm\application\classes\Controller\cards.php
и модели
C:\xampp\htdocs\citycrm\application\classes\Model\company.php
C:\xampp\htdocs\citycrm\application\classes\Model\contact.php
C:\xampp\htdocs\citycrm\application\classes\Model\card.php
Теперь список организаций,  пиплов и карт выводится в зависимости от id_pep авторизованного пользователя.
11.11.2023
вер. 3.2
[+]
Добавлен контроль длины номера карты. Теперь он строго 8 знаков.
Добавлен раздел Гость в левом меню.
Реализованы основные функции регистрации гостя и выдачи, изъятия гостевой карты.
Добавлены настройка параметров работы гостевой системы (сделан раздел Настройки).
Сделано новый класс Eventguest, который "приводит" разнотипные события к одному виду, что позволяет выводить информацию в Истории в нормальном виде.
[*]
Исправлено добавление организаций. Организации добавляются правильно.
Исправлена ошибка при отсутсвии связи с БД СКУД. Теперь сообщение об ошибке выводится корректно.
В окне ввода логина добавлены версия и путь к БД СКУД.
[ToDo]
+ - реализовано
В таблице setting может не оказаться строк с именами idOrgGuest и idOrgGuestArchive, и тогда настроить гостевой режим будет невозможно, и работа будет некорректна.
Удаление организаций. Как быть с людьми, туда входящими?
+ Организации - добавить иконку для быстрого просмотра людей, входящих в организацию.
Удалени людей - в зависимости от настроек системы. Если указано, что не удалять, а делать неактивными - то так и делать.
Верхнее правое меню Настройки не реализовано. Надо реализовывать. И именно тут сделать^
- настройку про способ удаления (делать неактивным или удалять сразу),
- показыать ли неактивных пиплов в общих списках.

Сделать закладку "Удаленные", там повторить все, что и в Организации (?), но показывать только удаленных.


1.10.2023
[+]
Добавлена форма регистрация ГРЗ.
Форма сделана как отдельная, чтобы было проще выводить информацию о ГРЗ.

[*]
При регистрации карты и указания тип 4 (ГРЗ) поле NOTE используется для хранения модели (марки) транспортного средства.
Внесены изменения в модель card с тем, чтобы принимать из POST-запроса поля NOTE и id_cardtype.

17.08.2023
вер. 3.1
[+]
при изменении родительской организации и установленной метке "Наследовать категори..." у контакта происходит пересчет набора категорий доступа: ненужные удаляются, недостающие добавляются.
при изменении родительской организации и снатой метки "Наследовать категори..." у контакте пересчет категори доступа НЕ производится.
Контакты - редактирование добавлено окно "Cписок категорий доступа контакта".
В окне Cписок категорий доступа контакта добавлены пояснения: совпадает ли набор категорий доступа контакта и родительской организации:
- зеленый цвет - совпадает,
- красный цвет - количество категорий доступа у контакта меньше, чем у родительской организации. КРасный цвето необходимо для привлечения внимания.
- желтый цвет - количество категорий доступа у контакта БОЛЬШЕ, чем у родительской организации. Желытый цвет играет роль предупреждения.
Заголовок окне выбора организации сделан как ссылка, что позволяет быстро перейти на просмотр свойств родительской организации.
Контакты- Категории доступа перечень категорий доступа сделвн в виде четырех колонок, что позволило разместить все категории доступа на одной странице без прокрутки. 
Косметические изменения дизайна


15.08.2023
Вер. 3.0.
по сравнению с исходным вариантов следующие доработки:
-отредактирован файлы PDO.phр с целью исключить ошибку lastInsertId. Отерадактированный файл находится в папке  C:\xampp\htdocs\citycrm\application\classes\Kohana\Database\PDO.php
-отредактирован файл Query.php: теперь параметры для SQL запроса передаются правильно, с кавычками. Отредактированный файл находится в папке C:\xampp\htdocs\citycrm\application\classes\Kohana\Database\Query.php
- в файле C:\xampp\htdocs\citycrm\application\config\config_newcrm.php добавлен массив module. В файлы 
 C:\xampp\htdocs\citycrm\application\views\sidebar.php и C:\xampp\htdocs\citycrm\application\views\header.php добавлены проверки для вывода пунктов меню.
 - система передана в Вестергаден для тестирования. в ходе тестирования внесены исправления:
 C:\xampp\htdocs\citycrm\application\classes\Model\contact.php public function add_contact_acl($id_pep, $id_accessname)  был SQL Insert, а вызывался DB::query(Database::INSERT, что приводило к ошибке focuse...
 C:\xampp\htdocs\citycrm\application\views\contacts\card.php при добавлении карты не были доступны пункты сохранения и перехода с списку. проблему исправил т.о.:
 <?php if (isset($card) or 1) { ?> - я добавил " or 1 ".

Я получил pdf отчет. Выбрал Статистика - О системе - Сохранить отчет в файл. в ходе выполнения появлялись сообщения о deprecated в файлах C:\xampp\htdocs\citycrm\application\vendor\mpdf\mpdf.php (и еще каком-то файле). В результате отчет был создан!

ToDo
12.11.2023
Надо добавить регистрацию ГРЗ для гостей.
Требуется разделение прав оператора:
	- Не все операторы должны иметь возможность удалять данные.
	- должно быть разделение логин - набор открываемых форм (например, только Гостей).
